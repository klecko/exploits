#ifndef _COMMON_H
#define _COMMON_H

#include <stdio.h>
#include <stdlib.h>
#include <sys/ioctl.h>

#define die(...) do {    \
    printf(__VA_ARGS__); \
    exit(EXIT_FAILURE);  \
} while (0)

#define error_on(cond, ...) do {                                                  \
    if (cond) {                                                                   \
        printf("Error at `%s` %s:%d\n", __PRETTY_FUNCTION__, __FILE__, __LINE__); \
        printf(__VA_ARGS__);                                                      \
        printf(": %s (-%d)\n", strerror(errno), errno);                           \
        exit(EXIT_FAILURE);                                                       \
    }                                                                             \
} while(0)

#define error(...) error_on(true, __VA_ARGS__)

#define ioctl_chk(fd, req, arg)         \
    ({                                  \
        int ret = ioctl(fd, req, arg);  \
        error_on(ret == -1, #req);      \
        ret;                            \
    })

#endif